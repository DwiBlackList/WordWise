import{j as o}from"./jsplumb-C0sRuFZe.js";class c{constructor(e){this.nodeCounter=0,this.nodeContainer=document.getElementById(e),this.selectedNode=null,this.startNode=null,this.nodes=[],this.undoStack=[],this.redoStack=[],this.gridSize=20,this.initializeJsPlumb(e),this.createInitialNodes()}initializeJsPlumb(e){o.jsPlumb.setContainer(e),o.jsPlumb.importDefaults({Connector:["Flowchart",{cornerRadius:5,gap:10}],PaintStyle:{stroke:"#888",strokeWidth:2},HoverPaintStyle:{stroke:"#ac74d3",strokeWidth:3},EndpointStyle:{radius:3,fill:"#888"},ConnectorStyle:{stroke:"#888",strokeWidth:2}})}createInitialNodes(){const e=Math.round(window.innerHeight/2/this.gridSize)*this.gridSize;this.addNode("start",this.gridSize,e),this.addNode("end",Math.round((window.innerWidth-200)/this.gridSize)*this.gridSize,e)}addNode(e){if(type==="start"&&this.startNode){console.warn("A start node already exists.");return}return this.nodeCounter++,`${this.nodeCounter}`,this.nodeContainer.appendChild(e.element),this.makeNodeDraggable(e.element),this.addEndpoints(e.element,type),this.addNodeClickListener(e),this.nodes.push(e),this.executeAction({action:"add",node:e}),e.element}makeNodeDraggable(e){o.jsPlumb.draggable(e,{containment:"parent",grid:[this.gridSize,this.gridSize],drag:()=>{o.jsPlumb.repaintEverything()}})}addNodeClickListener(e){e.element.addEventListener("click",()=>{this.selectedNode=e.element,document.querySelectorAll(".node").forEach(t=>t.classList.remove("selected")),e.element.classList.add("selected")})}addEndpoints(e,t){t!=="start"&&o.jsPlumb.addEndpoint(e,{anchor:"Left",isTarget:!0,paintStyle:{fill:"#2196f3"},maxConnections:-1,endpoint:["Dot",{radius:7}]}),t!=="end"&&o.jsPlumb.addEndpoint(e,{anchor:"Right",isSource:!0,paintStyle:{fill:"#ff9800"},maxConnections:-1,endpoint:["Dot",{radius:7}]})}executeAction(e){this.undoStack.push(e),this.redoStack=[],e.action==="add"&&this.addNode(e.node.type,e.node.x,e.node.y,e.node.options)}undo(){const e=this.undoStack.pop();if(e){switch(e.action){case"add":this.removeNode(e.node.id);break}this.redoStack.push(e)}}redo(){const e=this.redoStack.pop();if(e){switch(e.action){case"add":this.addNode(e.node.type,e.node.x,e.node.y,e.node.options);break}this.undoStack.push(e)}}removeNode(e){const t=this.nodes.findIndex(s=>s.id===e);if(t===-1)return;const i=this.nodes[t];this.nodeContainer.removeChild(i.element),this.nodes.splice(t,1),o.jsPlumb.removeAllEndpoints(i.element)}serialize(){return JSON.stringify(this.nodes.map(e=>({id:e.id,type:e.constructor.name,x:e.x,y:e.y,options:e.options})))}deserialize(e){const t=JSON.parse(e);this.nodes=t.map(i=>{const{id:s,type:d,x:r,y:l,options:h}=i,a=this.createNode(d,s,r,l,h);return this.nodeContainer.appendChild(a.element),this.makeNodeDraggable(a.element),this.addEndpoints(a.element,d),a})}inputChangeAction(e,t,i,s){const d={execute:()=>{t.value=s},undo:()=>{t.value=i}};this.executeAction(d)}}class m{constructor(e,t){this.nodeContainer=document.getElementById(e),this.zoomLabel=document.getElementById(t),this.zoomLevel=1,this.isPanning=!1,this.startX=0,this.startY=0,this.panX=0,this.panY=0,this.initEventListeners()}initEventListeners(){this.nodeContainer.addEventListener("mousedown",e=>{this.isPanning=!0,this.startX=e.clientX-this.panX,this.startY=e.clientY-this.panY}),document.addEventListener("mousemove",e=>{this.isPanning&&(this.panX=e.clientX-this.startX,this.panY=e.clientY-this.startY,this.updateCanvasZoom())}),document.addEventListener("mouseup",()=>{this.isPanning=!1}),this.nodeContainer.addEventListener("wheel",e=>{e.preventDefault();const t=.001;this.zoomLevel+=e.deltaY*-t,this.zoomLevel=Math.min(Math.max(.5,this.zoomLevel),2),this.updateCanvasZoom()}),document.getElementById("reset-zoom").addEventListener("click",()=>{this.zoomLevel=1,this.updateCanvasZoom()})}updateCanvasZoom(){const e=Math.min(window.innerWidth/this.nodeContainer.offsetWidth,window.innerHeight/this.nodeContainer.offsetHeight);this.zoomLevel=Math.max(e,Math.min(this.zoomLevel,1.5));const t=(this.nodeContainer.offsetWidth*this.zoomLevel-window.innerWidth)/2,i=(this.nodeContainer.offsetHeight*this.zoomLevel-window.innerHeight)/2;this.panX=Math.min(Math.max(this.panX,-t),0),this.panY=Math.min(Math.max(this.panY,-i),0),this.nodeContainer.style.transform=`translate(${this.panX}px, ${this.panY}px) scale(${this.zoomLevel})`,this.zoomLabel.innerText=`${Math.round(this.zoomLevel*100)}%`,jsPlumb.repaintEverything()}}document.addEventListener("DOMContentLoaded",function(){jsPlumb.ready(function(){const n=new c("node-container");new m("node-container","zoom-label"),document.getElementById("add-dialogue").addEventListener("click",()=>{n.addNode("dialogue",100,100)}),document.getElementById("add-choice").addEventListener("click",()=>{n.addNode("choice",200,100)}),document.getElementById("add-end").addEventListener("click",()=>{n.addNode("end",300,100)}),document.getElementById("undo").addEventListener("click",()=>{n.undo()}),document.getElementById("redo").addEventListener("click",()=>{n.redo()}),document.addEventListener("keydown",e=>{(e.key==="x"||e.key==="Delete")&&n.selectedNode?(jsPlumb.removeAllEndpoints(n.selectedNode),n.selectedNode.remove(),n.selectedNode=null):e.ctrlKey&&e.key==="z"&&n.undo()}),document.getElementById("toggle-tooltip").addEventListener("click",function(){const e=document.querySelector(".tooltip");e.classList.toggle("minimized");const t=this.querySelector("#icon");t.innerText=e.classList.contains("minimized")?"Tooltips":"",t.className=e.classList.contains("minimized")?"icon":"icon-showed",this.className=e.classList.contains("minimized")?"tooltip-button":"tooltip-button-showed"})})});
